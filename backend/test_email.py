#!/usr/bin/env python3
"""
–¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
"""
import os
import sys

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∏–º–ø–æ—Ä—Ç–æ–º –º–æ–¥—É–ª–µ–π
# –ù–ê–°–¢–†–û–ô–ö–ò –î–õ–Ø MAIL.RU:
# 1. –ó–∞–º–µ–Ω–∏—Ç–µ SMTP_USER –Ω–∞ –≤–∞—à email –∞–¥—Ä–µ—Å Mail.ru (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@mail.ru)
# 2. –ó–∞–º–µ–Ω–∏—Ç–µ SMTP_PASSWORD –Ω–∞ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ Mail.ru
# 3. SMTP_FROM_EMAIL –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å SMTP_USER

os.environ["SMTP_HOST"] = "smtp.mail.ru"
os.environ["SMTP_PORT"] = "465"  # Mail.ru –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—Ä—Ç 465 —Å SSL
os.environ["SMTP_USER"] = "andrey_mironov02@mail.ru"  # –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à email
os.environ["SMTP_PASSWORD"] = "qtQkoadTgEZgp8y0xsW8"  # –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
os.environ["SMTP_FROM_EMAIL"] = "andrey_mironov02@mail.ru"  # –ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ –≤–∞—à email
os.environ["SMTP_USE_TLS"] = "false"  # –î–ª—è –ø–æ—Ä—Ç–∞ 465 –∏—Å–ø–æ–ª—å–∑—É–µ–º SSL, TLS –Ω–µ –Ω—É–∂–µ–Ω

# –¢–µ–ø–µ—Ä—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
from app.email_service import (
    send_email,
    send_notification_city_news,
    send_notification_event,
    SMTP_HOST,
    SMTP_PORT,
    SMTP_USER,
    SMTP_PASSWORD,
    SMTP_FROM_EMAIL,
    SMTP_USE_TLS
)

def print_smtp_settings():
    """–í—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP"""
    print("=" * 60)
    print("–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP:")
    print(f"  SMTP_HOST: {SMTP_HOST}")
    print(f"  SMTP_PORT: {SMTP_PORT}")
    print(f"  SMTP_USER: {SMTP_USER}")
    print(f"  SMTP_PASSWORD: {'*' * len(SMTP_PASSWORD) if SMTP_PASSWORD else '–ù–ï –£–°–¢–ê–ù–û–í–õ–ï–ù'}")
    print(f"  SMTP_FROM_EMAIL: {SMTP_FROM_EMAIL}")
    print(f"  SMTP_USE_TLS: {SMTP_USE_TLS}")
    print("=" * 60)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è Mail.ru
    if "mail.ru" in SMTP_HOST.lower():
        print("\n‚ö†Ô∏è  –í–ê–ñ–ù–û –¥–ª—è Mail.ru:")
        print("   1. SMTP_USER –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–û–õ–ù–´–ú email –∞–¥—Ä–µ—Å–æ–º:")
        print("      - @mail.ru (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@mail.ru)")
        print("      - @inbox.ru (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@inbox.ru)")
        print("      - @bk.ru (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@bk.ru)")
        print("      - @list.ru (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@list.ru)")
        print(f"      –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {SMTP_USER}")
        print()
        print("   2. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ '–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!")
        print("   3. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:")
        print("      - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://id.mail.ru/profile ‚Üí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å")
        print("      - –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é (–µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞)")
        print("      - –†–∞–∑–¥–µ–ª '–ü–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π' ‚Üí '–°–æ–∑–¥–∞—Ç—å –ø–∞—Ä–æ–ª—å'")
        print("      - –í—ã–±–µ—Ä–∏—Ç–µ '–ü–æ—á—Ç–∞' –∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª—å")
        print("      - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –≤ SMTP_PASSWORD")
        print()
        print("   4. –ü–æ—Ä—Ç 465 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSL (SMTP_USE_TLS=false)")
        print()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email
        if "@" not in SMTP_USER:
            print("   ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: SMTP_USER –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @ (–ø–æ–ª–Ω—ã–π email –∞–¥—Ä–µ—Å)")
        elif not any(SMTP_USER.endswith(domain) for domain in ["@mail.ru", "@inbox.ru", "@bk.ru", "@list.ru"]):
            print("   ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: SMTP_USER –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥—Ä–µ—Å–æ–º Mail.ru")
        elif "–í–ê–®_EMAIL" in SMTP_USER or "–í–ê–®_–ü–ê–†–û–õ–¨" in SMTP_PASSWORD:
            print("   ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: –ó–∞–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–∞ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ!")
        else:
            print("   ‚úÖ –§–æ—Ä–º–∞—Ç SMTP_USER –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω")
        print()
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è Yandex
    elif "yandex" in SMTP_HOST.lower():
        print("\n‚ö†Ô∏è  –í–ê–ñ–ù–û –¥–ª—è Yandex:")
        print("   1. SMTP_USER –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–û–õ–ù–´–ú email –∞–¥—Ä–µ—Å–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@yandex.ru)")
        print("      ‚úÖ –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ: " + SMTP_USER)
        print()
        print("   2. –í–∫–ª—é—á–∏—Ç–µ –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏")
        print("   3. –°–æ–∑–¥–∞–π—Ç–µ '–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è' —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –ø–æ—á—Ç—ã:")
        print("      - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://id.yandex.ru/security")
        print("      - –í–∫–ª—é—á–∏—Ç–µ '–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é'")
        print("      - –°–æ–∑–¥–∞–π—Ç–µ '–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è' –¥–ª—è '–ü–æ—á—Ç–∞'")
        print("      - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ—Ç –ø–∞—Ä–æ–ª—å –≤ SMTP_PASSWORD")
        print()
        print("   4. –ü–æ—Ä—Ç 465 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SSL (SMTP_USE_TLS=false)")
        print()
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ email
        if "@" not in SMTP_USER:
            print("   ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: SMTP_USER –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @ (–ø–æ–ª–Ω—ã–π email –∞–¥—Ä–µ—Å)")
        elif not SMTP_USER.endswith("@yandex.ru") and not SMTP_USER.endswith("@ya.ru"):
            print("   ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï: SMTP_USER –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥—Ä–µ—Å–æ–º Yandex (@yandex.ru –∏–ª–∏ @ya.ru)")
        else:
            print("   ‚úÖ –§–æ—Ä–º–∞—Ç SMTP_USER –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω")
        print()
    
    print()

def test_simple_email():
    """–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ—Å—Ç–æ–≥–æ email"""
    print("–¢–µ—Å—Ç 1: –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ—Å—Ç–æ–≥–æ email")
    print("-" * 60)
    
    to_email = input("–í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SMTP_USER): ").strip()
    if not to_email:
        to_email = SMTP_USER
    
    subject = "–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –æ—Ç Social Hack 2025"
    html_body = """
    <html>
        <body>
            <h2>–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ</h2>
            <p>–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã SMTP —Å–µ—Ä–≤–µ—Ä–∞.</p>
            <p>–ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç–æ –ø–∏—Å—å–º–æ, –∑–Ω–∞—á–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!</p>
            <hr>
            <p style="color: #888; font-size: 12px;">
                –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.
            </p>
        </body>
    </html>
    """
    
    text_body = """
–¢–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ

–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–∏—Å—å–º–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã SMTP —Å–µ—Ä–≤–µ—Ä–∞.
–ï—Å–ª–∏ –≤—ã –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç–æ –ø–∏—Å—å–º–æ, –∑–Ω–∞—á–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SMTP —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

---
–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞.
    """
    
    print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–∏—Å—å–º–∞ –Ω–∞ {to_email}...")
    result = send_email(to_email, subject, html_body, text_body)
    
    if result:
        print("‚úÖ –ü–∏—Å—å–º–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –ø–∏—Å—å–º–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.")
    
    print()

def test_city_news_notification():
    """–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ—Å—Ç–∏"""
    print("–¢–µ—Å—Ç 2: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –≥–æ—Ä–æ–¥–∞")
    print("-" * 60)
    
    to_email = input("–í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SMTP_USER): ").strip()
    if not to_email:
        to_email = SMTP_USER
    
    city = input("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è '–ú–æ—Å–∫–≤–∞'): ").strip()
    if not city:
        city = "–ú–æ—Å–∫–≤–∞"
    
    print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ {to_email}...")
    result = send_notification_city_news(
        to_email=to_email,
        news_title="–¢–µ—Å—Ç–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å",
        news_text="–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–∞—è –Ω–æ–≤–æ—Å—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –Ω–æ–≤–æ—Å—Ç—è—Ö –∏–∑ –≥–æ—Ä–æ–¥–∞.",
        city=city
    )
    
    if result:
        print("‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ—Å—Ç–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.")
    
    print()

def test_event_notification():
    """–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏–∏"""
    print("–¢–µ—Å—Ç 3: –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏–∏")
    print("-" * 60)
    
    to_email = input("–í–≤–µ–¥–∏—Ç–µ email –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SMTP_USER): ").strip()
    if not to_email:
        to_email = SMTP_USER
    
    city = input("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ Enter –¥–ª—è '–ú–æ—Å–∫–≤–∞'): ").strip()
    if not city:
        city = "–ú–æ—Å–∫–≤–∞"
    
    print(f"–û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–æ–±—ã—Ç–∏–∏ –Ω–∞ {to_email}...")
    result = send_notification_event(
        to_email=to_email,
        event_name="–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ",
        event_description="–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ —Å–æ–±—ã—Ç–∏—è—Ö.",
        event_city=city,
        event_start="2025-01-15 10:00"
    )
    
    if result:
        print("‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!")
    else:
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤—ã—à–µ.")
    
    print()

def test_connection():
    """–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SMTP —Å–µ—Ä–≤–µ—Ä—É –±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞"""
    print("–¢–µ—Å—Ç 0: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ SMTP —Å–µ—Ä–≤–µ—Ä—É")
    print("-" * 60)
    
    import smtplib
    
    # –î–ª—è Yandex –ø—Ä–æ–±—É–µ–º –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: –ø–æ—Ä—Ç 465 (SSL) –∏ –ø–æ—Ä—Ç 587 (TLS)
    if "yandex" in SMTP_HOST.lower():
        print("‚ö†Ô∏è  Yandex –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:")
        print("   1. –ü–æ—Ä—Ç 465 —Å SSL (SMTP_SSL)")
        print("   2. –ü–æ—Ä—Ç 587 —Å TLS (SMTP + STARTTLS)")
        print()
        print("–ü—Ä–æ–±—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ—Ä—Ç 465 —Å SSL...")
        print("-" * 60)
        
        try:
            server = smtplib.SMTP_SSL(SMTP_HOST, 465, timeout=30)
            print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ä—Ç—É 465 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
            print("–ü–æ–ø—ã—Ç–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...")
            server.login(SMTP_USER, SMTP_PASSWORD)
            print("‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ –Ω–∞ –ø–æ—Ä—Ç—É 465!")
            server.quit()
            return True
        except smtplib.SMTPAuthenticationError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞ –ø–æ—Ä—Ç—É 465: {e}")
            print()
            print("–ü—Ä–æ–±—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ—Ä—Ç 587 —Å TLS...")
            print("-" * 60)
            
            try:
                server = smtplib.SMTP(SMTP_HOST, 587, timeout=30)
                print("‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Ä—Ç—É 587 —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ")
                print("–í–∫–ª—é—á–∞–µ–º TLS...")
                server.starttls()
                print("–ü–æ–ø—ã—Ç–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...")
                server.login(SMTP_USER, SMTP_PASSWORD)
                print("‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞ –Ω–∞ –ø–æ—Ä—Ç—É 587!")
                server.quit()
                print("\nüí° –†–ï–®–ï–ù–ò–ï: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ—Ä—Ç 587 —Å TLS=true")
                print("   –û–±–Ω–æ–≤–∏—Ç–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ:")
                print("   SMTP_PORT = 587")
                print("   SMTP_USE_TLS = true")
                return True
            except Exception as e2:
                print(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞ –ø–æ—Ä—Ç—É 587: {e2}")
                print_authentication_help()
                return False
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø–æ—Ä—Ç—É 465: {e}")
            print_authentication_help()
            return False
    else:
        # –î–ª—è –¥—Ä—É–≥–∏—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –ª–æ–≥–∏–∫—É
        try:
            print(f"–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ {SMTP_HOST}:{SMTP_PORT}...")
            
            if SMTP_PORT == 465:
                print("–ò—Å–ø–æ–ª—å–∑—É–µ–º SMTP_SSL –¥–ª—è –ø–æ—Ä—Ç–∞ 465...")
                server = smtplib.SMTP_SSL(SMTP_HOST, SMTP_PORT, timeout=30)
            else:
                print(f"–ò—Å–ø–æ–ª—å–∑—É–µ–º SMTP —Å TLS={SMTP_USE_TLS}...")
                server = smtplib.SMTP(SMTP_HOST, SMTP_PORT, timeout=30)
                if SMTP_USE_TLS:
                    print("–í–∫–ª—é—á–∞–µ–º TLS...")
                    server.starttls()
            
            print("–ü–æ–ø—ã—Ç–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏...")
            server.login(SMTP_USER, SMTP_PASSWORD)
            print("‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!")
            server.quit()
            return True
            
        except smtplib.SMTPAuthenticationError as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏: {e}")
            return False
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
            import traceback
            traceback.print_exc()
            return False

def print_authentication_help():
    """–í—ã–≤–æ–¥–∏—Ç –ø–æ–º–æ—â—å –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –¥–ª—è Yandex"""
    print("\nüí° –î–ª—è Yandex:")
    print("   1. SMTP_USER –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ü–û–õ–ù–´–ú email –∞–¥—Ä–µ—Å–æ–º:")
    print(f"      –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: {SMTP_USER}")
    if "@" not in SMTP_USER:
        print("      ‚ùå –û–®–ò–ë–ö–ê: SMTP_USER –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å @ (–Ω–∞–ø—Ä–∏–º–µ—Ä: user@yandex.ru)")
    elif not (SMTP_USER.endswith("@yandex.ru") or SMTP_USER.endswith("@ya.ru")):
        print("      ‚ùå –û–®–ò–ë–ö–ê: SMTP_USER –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥—Ä–µ—Å–æ–º Yandex")
    else:
        print("      ‚úÖ –§–æ—Ä–º–∞—Ç email –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω")
    print()
    print("   2. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ '–ü–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', –∞ –Ω–µ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä–æ–ª—å!")
    print("   3. –°–æ–∑–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:")
    print("      - –ü–µ—Ä–µ–π–¥–∏—Ç–µ: https://id.yandex.ru/security")
    print("      - –í–∫–ª—é—á–∏—Ç–µ '–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é' (–µ—Å–ª–∏ –Ω–µ –≤–∫–ª—é—á–µ–Ω–∞)")
    print("      - –í —Ä–∞–∑–¥–µ–ª–µ '–ü–∞—Ä–æ–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π' —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å")
    print("      - –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: '–ü–æ—á—Ç–∞' –∏–ª–∏ '–î—Ä—É–≥–æ–µ'")
    print("      - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å (–æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)")
    print()
    print("   4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:")
    print("      - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω –¥–æ—Å—Ç—É–ø –∫ –ø–æ—á—Ç–µ —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è")
    print("      - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –ø–∏—Å–µ–º")
    print()
    print("   5. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ –ø–æ—Ä—Ç–æ–≤:")
    print("      - –ü–æ—Ä—Ç 465 —Å SSL (SMTP_USE_TLS=false)")
    print("      - –ü–æ—Ä—Ç 587 —Å TLS (SMTP_USE_TLS=true)")

def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print_smtp_settings()
    
    if not SMTP_USER or not SMTP_PASSWORD:
        print("‚ùå –û–®–ò–ë–ö–ê: SMTP_USER –∏–ª–∏ SMTP_PASSWORD –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!")
        print("–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞.")
        sys.exit(1)
    
    print("–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç:")
    print("0. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–±–µ–∑ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∏—Å—å–º–∞)")
    print("1. –ü—Ä–æ—Å—Ç–æ–µ email –ø–∏—Å—å–º–æ")
    print("2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ—Å—Ç–∏ –∏–∑ –≥–æ—Ä–æ–¥–∞")
    print("3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Å–æ–±—ã—Ç–∏–∏")
    print("4. –í—Å–µ —Ç–µ—Å—Ç—ã –ø–æ–¥—Ä—è–¥")
    print("q. –í—ã—Ö–æ–¥")
    print()
    
    choice = input("–í–∞—à –≤—ã–±–æ—Ä: ").strip()
    
    if choice == "0":
        test_connection()
    elif choice == "1":
        test_simple_email()
    elif choice == "2":
        test_city_news_notification()
    elif choice == "3":
        test_event_notification()
    elif choice == "4":
        if test_connection():
            print()
            test_simple_email()
            test_city_news_notification()
            test_event_notification()
    elif choice == "q" or choice == "exit":
        print("–í—ã—Ö–æ–¥...")
        sys.exit(0)
    else:
        print("–ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä!")
        sys.exit(1)

if __name__ == "__main__":
    try:
        main()
    except KeyboardInterrupt:
        print("\n\n–ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
        sys.exit(0)
    except Exception as e:
        print(f"\n‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
        import traceback
        traceback.print_exc()
        sys.exit(1)

